<!DOCTYPE html>
<html>
<head>
  <title>BrowseBack - Code Reload Verification</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h1 {
      color: #6366f1;
    }
    .status {
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      font-weight: 600;
    }
    .success {
      background: #d1fae5;
      color: #065f46;
      border: 2px solid #10b981;
    }
    .error {
      background: #fee2e2;
      color: #991b1b;
      border: 2px solid #ef4444;
    }
    .info {
      background: #dbeafe;
      color: #1e40af;
      border: 2px solid #3b82f6;
    }
    button {
      background: #6366f1;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #4f46e5;
    }
    pre {
      background: #1f2937;
      color: #f3f4f6;
      padding: 15px;
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
    }
    .step {
      background: #f9fafb;
      padding: 12px;
      border-left: 4px solid #6366f1;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üîç BrowseBack Code Reload Verification</h1>
    <p>Use this page to verify the extension loaded the new code with the <code>getAll()</code> method.</p>
  </div>

  <div class="card">
    <h2>Quick Test</h2>
    <button onclick="testGetAll()">Test getAll() Method</button>
    <button onclick="checkVersion()">Check StorageManager Version</button>
    <button onclick="viewConsole()">View Extension Console</button>

    <div id="result"></div>
  </div>

  <div class="card">
    <h2>Manual Reload Steps</h2>
    <div class="step">
      <strong>Step 1:</strong> Go to <code>chrome://extensions</code>
    </div>
    <div class="step">
      <strong>Step 2:</strong> Toggle BrowseBack <strong>OFF</strong> then <strong>ON</strong>
    </div>
    <div class="step">
      <strong>Step 3:</strong> Click the reload icon (circular arrow)
    </div>
    <div class="step">
      <strong>Step 4:</strong> Come back here and click "Test getAll() Method"
    </div>
  </div>

  <div class="card">
    <h2>Expected Console Output</h2>
    <p>When you reload the extension, you should see:</p>
    <pre>StorageManager v1.1.0 initialized
BrowseBack: Initializing...
BrowseBack: Building semantic search index...
‚úÖ Indexed 127 documents with 2847 terms
BrowseBack: Semantic index built with 127 documents</pre>
  </div>

  <script>
    const resultDiv = document.getElementById('result');

    function showResult(message, type) {
      resultDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function testGetAll() {
      showResult('Testing... Please wait', 'info');

      // Try to call getAll through the background script
      chrome.runtime.sendMessage({ action: 'search', query: '' }, (response) => {
        if (chrome.runtime.lastError) {
          showResult(`‚ùå Error: ${chrome.runtime.lastError.message}`, 'error');
          return;
        }

        if (response.error) {
          if (response.error.includes('getAll')) {
            showResult(`‚ùå OLD CODE STILL LOADED<br><br>The getAll() method doesn't exist yet.<br><br><strong>Action needed:</strong> Follow the reload steps above!`, 'error');
          } else {
            showResult(`‚ùå Error: ${response.error}`, 'error');
          }
          return;
        }

        if (response.results) {
          showResult(`‚úÖ SUCCESS!<br><br>New code is loaded!<br>Found ${response.results.length} captures.<br><br>The getAll() method is working correctly!`, 'success');
        }
      });
    }

    function checkVersion() {
      showResult('Checking version...', 'info');

      // The version will appear in console when StorageManager is created
      showResult(`‚ÑπÔ∏è Check the extension console for:<br><pre>StorageManager v1.1.0 initialized</pre><br>Click "View Extension Console" button.`, 'info');
    }

    function viewConsole() {
      showResult(`‚ÑπÔ∏è To view the extension console:<br><br>1. Go to chrome://extensions<br>2. Find BrowseBack<br>3. Click the blue "service worker" link<br>4. Look for "StorageManager v1.1.0 initialized"`, 'info');
    }

    // Auto-test on load
    setTimeout(() => {
      showResult('Click "Test getAll() Method" to verify the code loaded', 'info');
    }, 500);
  </script>
</body>
</html>
